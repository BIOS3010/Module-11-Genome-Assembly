# Exercise 3 - Assembly Quality

## Assembly completeness - BUSCO

We like to use BUSCO to assess the completeness of an assembly. BUSCO (https://busco.ezlab.org/) uses a set of conserved genes that should be present in the species we are interested in. For instance, if you run it on a mammalian species, it tries to find 4104 genes. A high quality genome assembly should have the vast majority of these present and with exons in the correct order and orientation with regards to each other. In vertebrates, genes can span several 100 kbp, so if most genes are found complete, it is likely that the genome assembly is of high quality.

### Running BUSCO

First, let's do the assembly QC in a new folder, for example `~/assembly_qc`. Create this folder and `cd` into it.

Second, as the BUSCO analysis will take some time, we run it again inside a *screen*. It is advised to start a new screen for this

*NOTE* feel free to terminate any other screens you still may have by re-entering them and writing `exit`.

To get started with BUSCO, we need to run the following commands:

```
module load BUSCO/5.0.0-foss-2020a
```

To have a look at the available BUSCO gene sets for different species use:

`busco --list-datasets`

We will all run BUSCO using the insect dataset, **insecta_odb10**. If you want you could try a different one in addition, for instance for arthropods or eukaryotes.

To run BUSCO on the canu assembly use:

```
busco \
-c 3 \
-i /home/username/canu_assembly/k12.contigs.fasta \
-l insecta_odb10 \
-m genome \
-o canu_busco 1> canu_busco.out 2> canu_busco.err
```

For flye, use

```
busco \
-c 3 \
-i /home/username/flye_assembly/assembly.fasta \
-l insecta_odb10 \
-m genome \
-o flye_busco 1> flye_busco.out 2> flye_busco.err
```

As always, change `username` with your username and make sure the path to the assembly file is correct.

**NOTE** *If your assembly did not complete*, copy one of the finished assembly that we made available in the folders `/storage/BIOS3010/Genome_assembly/canu_assembly` or `/storage/BIOS3010/Genome_assembly/flye_assembly` to your home directory and run BUSCO on it.

Here:
* we use the backslash `\` so we can write the command over multiple lines, making it easier to read
* `-c 3` means use 3 compute threads (CPUs)
* `-i ` is the assembly file to use
* `-l` is the name if the gene set
* `-m genome` indicates we are testing a full genome (not only a set of gene or protein sequences)
* `-o` indicates the name of the folder BUSCO will write its output in
* `1> canu_busco.out 2> canu_busco.err` asks unix to save the messages from BUSCO in different files.

Exit the screen with `Ctrl + A + D` as before.

Check to see if BUSCO is running using `top` and checking the `.err` and `.log` files.

An example BUSCO report looks like this:

`C:99.9%[S:99.9%,D:0.0%],F:0.1%,M:-0.0%,n:781`

This means that 99.9 % were complete and 0.1 % were incomplete.

Look in the file called `busco_insecta.out`. It is the last 10 lines or so which are important, so you can for instance write:

`tail busco_insecta.out`

````diff
! What scores did you get?
! How do you interpret these scores? Is the assembly complete?
````

## Assembly contiguity and correctness - QUAST

After doing a genome assembly, one of the questions is often about how correct and contiguous the assembly is.

It is not straight-forward to evaluate correctness for many projects. However, for *Bombus campestris* we have a reference to compare to downloaded from https://www.ebi.ac.uk/ena/browser/view/GCA_905333015, located in the shared folder here:

`less  /storage/BIOS3010/Genome_assembly/CAJOSK01.fasta`

This genome was generated using the following pipeline: The assembly iyBomCamp1.1 is based on 83x PacBio data, 10X Genomics Chromium data, and Arima Hi-C data generated by the Darwin Tree of Life Project (https://www.darwintreeoflife.org/). The assembly process included the following sequence of steps: initial PacBio assembly generation with Hifiasm, retained haplotig separation with purge_dups, short-read polishing using FreeBayes-called variants from 10X Genomics Chromium reads aligned with LongRanger, and Hi-C based scaffolding with SALSA2. The mitochondrial genome was assembled using MitoHifi. Finally, the assembly was analysed and manually improved using gEVAL. Chromosome-scale scaffolds confirmed by the Hi-C data have been named in order of size.

We can use Quast (https://github.com/ablab/quast) to find many different metrics of our genome assembly such as N50, number of misassemblies and number of genes (we do not have an annotation file so we will use the option --gene-finding. See more of the results given here: http://quast.sourceforge.net/docs/manual.html#sec3.1

Run Quast on your genome assembly. In the shared folder (/storage/BIOS3010/Genome_assembly/) you’ll find two scripts. Both of them are written to run on existing genome assemblies that we made as backup. Navigate to your ~/ folder and create a folder for Quast. For instance,

`cd`

`mkdir quast_canu`

if you want to run it on the canu assembly. Enter the folder, and copy the correct script to this folder.
You may have to move the quast script to your assembly folder. Or edit the script so that the paths are correct in regard to your assembly.

`cp /storage/BIOS3010/Genome_assembly/quast_flye.sh ~/flye_canu/`

`cp /storage/BIOS3010/Genome_assembly/quast_canu.sh ~/quast_canu/`

If you want to run it on your own assembly, make sure the paths are correct. Run the script and wait (It was finished in 1 minute or so when we tried it). *If your assembly did not complete, copy one of the finished assembly that I have put in the folders /storage/BIOS3010/Genome_assembly/canu_assembly or /storage/BIOS3010/Genome_assembly/flye_assembly to your home directory and run quast on this.*

Quast creates a subfolder with many different files. Take a look around in it. Then, look at the file called

`less quast_results/latest/report.txt`

````diff
! How many contigs longer than 50000 bp does your assembly consist of?
! What is the N50 length?
! How many misassemblies are there?
````

There is also a PDF file which you can download to your computer to look at.

I have uploaded the canu and flye quast reports to the github folder so you can compare the assembly programs.

````diff
! What are the main differences between flye and canu? (N50, misassemblies, longest contig…)
! Which assembly is more contiguous?
````

Navigate to where the reference assembly is located https://www.ebi.ac.uk/ena/browser/view/GCA_905333015

<img width="1263" alt="Screenshot 2021-05-01 at 13 47 44" src="https://user-images.githubusercontent.com/46928237/116781542-d1aac700-aa83-11eb-8b60-a55f5abf23a0.png">

Click on the “Assembly Statistics” on the right hand side.

````diff
! How does the reference genome assembly compare to your assembly in terms of contiguity?
````

You can also download the sequence report (click “Sequence Report” on the right hand side.

````diff
! How many chromosomes does the assembly contain?
````
